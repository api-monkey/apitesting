<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
<body>
<script type="text/javascript" th:src="@{|https://www.paypal.com/sdk/js?client-id=${payPalClientId}|}"></script>
<script>
    paypal.Buttons({

        // Set up the transaction
        createOrder: function(data, actions) {
            return actions.order.create({
                purchase_units: [{
                    amount: {
                        value: '24.00',
                        currency_code: 'USD'
                    }
                }],
                description: 'Detailed report of universities'
            });
        },

        // Finalize the transaction
        onApprove: function(data, actions) {
            return actions.order.capture().then(function(orderData) {
                // Successful capture! For demo purposes:
                let userDataId = $('#user-data-id').val();
                orderData['userDataId'] = userDataId;
                let orderDataStr = JSON.stringify(orderData);

                $.ajax({
                    url: '/content/scholarship/updatePayPalOrder',
                    type: 'post',
                    data: orderDataStr,
                    beforeSend: function(xhr) {
                        xhr.setRequestHeader("Accept", "application/json");
                        xhr.setRequestHeader("Content-Type", "application/json");
                    },
                    success: function (data) {
                        // console.log('Order sent');
                    },
                    error: function (jqXHR, exception) {
                        console.log(jqXHR.status);
                        console.log(exception);
                    },
                });

                // Replace the above to show a success message within this page, e.g.
                const element = document.getElementById('paypal-button-container');
                element.innerHTML = '';
                element.innerHTML = '<p class="h3 font-weight-normal text-muted text-center mb-4">Thank you for your payment!</p>';
                // Or go to another URL:  actions.redirect('thank_you.html');
            });
        }

    }).render('#paypal-button-container');
</script>
</body>
